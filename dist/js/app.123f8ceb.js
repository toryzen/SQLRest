(function(){"use strict";var e={9379:function(e,t,a){var l=a(9242),o=a(3396),s=a(7139);const i={class:"common-layout"},d=(0,o._)("div",{class:"flex-grow"},null,-1),r={key:0},u=(0,o._)("h2",null,"Project API Search",-1),n={key:1},m=(0,o._)("br",null,null,-1);function c(e,t,a,l,c,p){const h=(0,o.up)("router-link"),w=(0,o.up)("el-menu-item"),g=(0,o.up)("el-sub-menu"),f=(0,o.up)("el-menu"),y=(0,o.up)("el-header"),_=(0,o.up)("el-input"),b=(0,o.up)("el-col"),P=(0,o.up)("el-button"),W=(0,o.up)("el-row"),V=(0,o.up)("router-view"),j=(0,o.up)("el-main"),k=(0,o.up)("el-dialog"),A=(0,o.up)("el-container");return(0,o.wg)(),(0,o.iD)("div",i,[(0,o.Wm)(A,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{class:"el-menu-demo",mode:"horizontal",ellipsis:!1},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{index:"0"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{to:"/"},{default:(0,o.w5)((()=>[(0,o.Uk)("SQLRest Manage UI")])),_:1})])),_:1}),d,c.authKey?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(w,{key:0,index:"6",onClick:p.showLoginDialog},{default:(0,o.w5)((()=>[(0,o.Uk)("登录")])),_:1},8,["onClick"])),c.authKey?((0,o.wg)(),(0,o.j4)(w,{key:1,index:"1"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{to:"/project-list"},{default:(0,o.w5)((()=>[(0,o.Uk)("项目")])),_:1})])),_:1})):(0,o.kq)("",!0),c.authKey?((0,o.wg)(),(0,o.j4)(w,{key:2,index:"2"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{to:"/api-list"},{default:(0,o.w5)((()=>[(0,o.Uk)("API")])),_:1})])),_:1})):(0,o.kq)("",!0),c.authKey?((0,o.wg)(),(0,o.j4)(w,{key:3,index:"3"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{to:"/authkey-list"},{default:(0,o.w5)((()=>[(0,o.Uk)("密钥")])),_:1})])),_:1})):(0,o.kq)("",!0),c.authKey?((0,o.wg)(),(0,o.j4)(w,{key:4,index:"4"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{to:"/db-list"},{default:(0,o.w5)((()=>[(0,o.Uk)("数据源")])),_:1})])),_:1})):(0,o.kq)("",!0),c.authKey?((0,o.wg)(),(0,o.j4)(g,{key:5,index:"5"},{title:(0,o.w5)((()=>[(0,o.Uk)("操作")])),default:(0,o.w5)((()=>[(0,o.Wm)(w,{index:"5-2",onClick:p.logout},{default:(0,o.w5)((()=>[(0,o.Uk)(" 退出AuthKey："+(0,s.zw)(c.authKey),1)])),_:1},8,["onClick"])])),_:1})):(0,o.kq)("",!0)])),_:1})])),_:1}),(0,o.Wm)(j,null,{default:(0,o.w5)((()=>[c.authKey?((0,o.wg)(),(0,o.iD)("div",n,[(0,o.Wm)(V)])):((0,o.wg)(),(0,o.iD)("div",r,[u,(0,o.Wm)(W,{type:"flex",justify:"center",gutter:"10"},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{span:5},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{modelValue:c.inputProjectID,"onUpdate:modelValue":t[0]||(t[0]=e=>c.inputProjectID=e),placeholder:"请输入 Project ID"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(b,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"primary",onClick:p.searchProject},{default:(0,o.w5)((()=>[(0,o.Uk)("搜索")])),_:1},8,["onClick"])])),_:1})])),_:1})]))])),_:1}),(0,o.Wm)(k,{title:"请输入管理密钥",modelValue:c.loginDialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>c.loginDialogVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{type:"flex",justify:"center",gutter:"10"},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{span:8},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{modelValue:c.inputAuthKey,"onUpdate:modelValue":t[1]||(t[1]=e=>c.inputAuthKey=e),placeholder:"请输入AuthKey","show-password":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(b,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"primary",onClick:p.saveAuthKey},{default:(0,o.w5)((()=>[(0,o.Uk)("登录")])),_:1},8,["onClick"])])),_:1})])),_:1}),m])),_:1},8,["modelValue"])])),_:1})])}var p={data(){return{authKey:this.$store.state.authKey,inputAuthKey:"",inputProjectID:"",loginDialogVisible:!1}},methods:{showLoginDialog(){this.loginDialogVisible=!0},async saveAuthKey(){localStorage.setItem("authkey",this.inputAuthKey),this.$store.state.authKey=this.inputAuthKey;let e="limit 1";try{await this.$store.dispatch("project/fetchProjectsPaged",{limit:e}),location.reload()}catch(t){t.response&&401===t.response.status?(localStorage.setItem("authkey",""),this.$message({message:"授权认证失败，请重试！",type:"warning",showClose:!0})):this.$message({message:t,type:"error",showClose:!0})}},logout(){localStorage.removeItem("authkey"),location.reload()},async searchProject(){try{const e=await fetch(`${this.$store.state.baseUrl}/help?project_id=${this.inputProjectID}&check=check`),t=await e.text();"ok"===t?window.open(`${this.$store.state.baseUrl}/help?project_id=${this.inputProjectID}`,"_blank"):this.$message.error("未找到该项目，请检查输入的Project ID是否正确。")}catch(e){this.$message.error(`请求发生错误: ${e}`)}}}},h=a(89);const w=(0,h.Z)(p,[["render",c]]);var g=w,f=a(2483);const y=e=>((0,o.dD)("data-v-5f677f29"),e=e(),(0,o.Cn)(),e),_=y((()=>(0,o._)("h2",null,"项目管理",-1))),b=["href"],P=y((()=>(0,o._)("br",null,null,-1))),W=y((()=>(0,o._)("br",null,null,-1))),V=y((()=>(0,o._)("br",null,null,-1))),j=y((()=>(0,o._)("br",null,null,-1))),k={class:"pagination-container"};function A(e,t,a,i,d,r){const u=(0,o.up)("el-input"),n=(0,o.up)("el-col"),m=(0,o.up)("el-button"),c=(0,o.up)("el-row"),p=(0,o.up)("el-form-item"),h=(0,o.up)("el-form"),w=(0,o.up)("el-dialog"),g=(0,o.up)("el-divider"),f=(0,o.up)("el-table-column"),y=(0,o.up)("el-tooltip"),A=(0,o.up)("el-table"),U=(0,o.up)("el-pagination");return(0,o.wg)(),(0,o.iD)("div",null,[_,(0,o.Wm)(c,{type:"flex",justify:"center",gutter:"10"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.id,"onUpdate:modelValue":t[0]||(t[0]=e=>d.searchParams.id=e),placeholder:"ProjectID"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:4},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.project_name,"onUpdate:modelValue":t[1]||(t[1]=e=>d.searchParams.project_name=e),placeholder:"项目名称"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:4},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.memo,"onUpdate:modelValue":t[2]||(t[2]=e=>d.searchParams.memo=e),placeholder:"项目备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{type:"primary",onClick:r.searchProjects},{default:(0,o.w5)((()=>[(0,o.Uk)("搜索")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(n,{span:1},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{type:"success",onClick:r.showAddProjectForm},{default:(0,o.w5)((()=>[(0,o.Uk)("添加项目")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.Wm)(w,{title:"添加项目",modelValue:d.addFormVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>d.addFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{onSubmit:(0,l.iM)(r.addProject,["prevent"]),class:"add-project-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{label:"项目名称"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newProject.project_name,"onUpdate:modelValue":t[3]||(t[3]=e=>d.newProject.project_name=e),placeholder:"项目名称",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"项目备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newProject.memo,"onUpdate:modelValue":t[4]||(t[4]=e=>d.newProject.memo=e),placeholder:"项目备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(m,{type:"primary",onClick:r.addProject},{default:(0,o.w5)((()=>[(0,o.Uk)("添加")])),_:1},8,["onClick"]),(0,o.Wm)(m,{onClick:r.cancelAdd},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"]),(0,o.Wm)(g),(0,o.Wm)(A,{data:r.projects},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{type:"index",label:"ID"}),(0,o.Wm)(f,{prop:"project_id",label:"ProjectID"}),(0,o.Wm)(f,{prop:"project_name",label:"项目名称"}),(0,o.Wm)(f,{prop:"memo",label:"备注"}),(0,o.Wm)(f,{label:"API Docs"},{default:(0,o.w5)((({row:e})=>[(0,o._)("a",{href:r.getDocsUrl(e.project_id),target:"_blank"},"查看",8,b)])),_:1}),(0,o.Wm)(f,{label:"信息"},{default:(0,o.w5)((({row:e})=>[(0,o.Wm)(y,{placement:"top"},{content:(0,o.w5)((()=>[(0,o.Uk)(" 最后更新人："+(0,s.zw)(e.modified_user)+" ",1),P,(0,o.Uk)(" 更新时间："+(0,s.zw)(e.modified_stime)+" ",1),W,(0,o.Uk)(" 创建人："+(0,s.zw)(e.created_user)+" ",1),V,(0,o.Uk)(" 创建时间："+(0,s.zw)(e.created_stime)+" ",1),j])),default:(0,o.w5)((()=>[(0,o.Wm)(m,{type:"info",size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("信息")])),_:1})])),_:2},1024)])),_:1}),(0,o.Wm)(f,{label:"操作"},{default:(0,o.w5)((e=>[(0,o.Wm)(m,{type:"warning",onClick:t=>r.showUpdateForm(e.row.id),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("更新")])),_:2},1032,["onClick"]),(0,o.Wm)(m,{type:"danger",onClick:t=>r.confirmDelete(e.row.id),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),(0,o.Wm)(g),(0,o._)("div",k,[(0,o.Wm)(U,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,"current-page":d.currentPage,"page-sizes":[10,20,50,100],"page-size":d.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:d.totalRecords},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),(0,o.Wm)(w,{title:"更新项目信息",modelValue:d.updateFormVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>d.updateFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{onSubmit:(0,l.iM)(r.updateProjectInfo,["prevent"]),class:"update-project-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{label:"名称"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedProject.project_name,"onUpdate:modelValue":t[6]||(t[6]=e=>d.updatedProject.project_name=e),placeholder:"项目名称",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedProject.memo,"onUpdate:modelValue":t[7]||(t[7]=e=>d.updatedProject.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(u,{type:"hidden",modelValue:d.updatedProject.id,"onUpdate:modelValue":t[8]||(t[8]=e=>d.updatedProject.id=e)},null,8,["modelValue"]),(0,o.Wm)(m,{type:"primary",onClick:r.updateProjectInfo},{default:(0,o.w5)((()=>[(0,o.Uk)("保存")])),_:1},8,["onClick"]),(0,o.Wm)(m,{onClick:r.cancelUpdate},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"])])}var U={name:"ProjectList",data(){return{searchParams:{project_name:"",id:"",memo:""},newProject:{project_name:"",memo:""},updateFormVisible:!1,updatedProject:{id:"",project_name:"",memo:""},currentPage:1,totalPages:0,pageSize:10,totalRecords:0,addFormVisible:!1}},computed:{projects(){return this.$store.state.project.projects}},methods:{async addProject(){if(""===this.newProject.project_name.trim())return void this.$message({type:"error",message:"项目名称不能为空"});const e=await this.$store.dispatch("project/addProject",this.newProject);200===e.code?(console.log(e),this.$message({type:"success",message:"项目添加成功"})):this.$message({type:"error",message:"项目添加失败"}),this.newProject={project_name:"",memo:""},this.fetchProjectListByPage(),this.addFormVisible=!1},async removeProject(e){const t=await this.$store.dispatch("project/removeProject",e);200===t.code?this.$message({type:"success",message:"项目删除成功"}):this.$message({type:"error",message:"项目删除失败"}),this.fetchProjectListByPage()},confirmDelete(e){this.$confirm("确定要删除此项目吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeProject(e)})).catch((()=>{}))},showUpdateForm(e){const t=this.projects.findIndex((t=>t.id===e));if(-1!==t){const e=this.projects[t];this.updatedProject={id:e.id,project_name:e.project_name,memo:e.memo},this.updateFormVisible=!0}},async updateProjectInfo(){if(""===this.updatedProject.project_name.trim())return void this.showMessage("error","项目名称不能为空");const e=await this.$store.dispatch("project/updateProject",this.updatedProject);200===e.code?this.$message({type:"success",message:"项目更新成功"}):this.$message({type:"error",message:"项目更新失败"}),this.updatedProject={id:"",project_name:"",memo:""},this.updateFormVisible=!1,this.fetchProjectListByPage()},cancelUpdate(){this.updateFormVisible=!1},async fetchProjectListByPage(){const e=this.pageSize,t=(this.currentPage-1)*e;let a="";this.searchParams.id&&(a+=` AND project_id='${this.searchParams.id}'`),this.searchParams.project_name&&(a+=` AND project_name LIKE '%${this.searchParams.project_name}%'`),this.searchParams.memo&&(a+=` AND memo LIKE '%${this.searchParams.memo}%'`),a+=` limit ${t},${e}`;try{const t=await this.$store.dispatch("project/fetchProjectsPaged",{limit:a});this.totalRecords=t.data.length?parseInt(t.data[0].allcnt):0,this.totalPages=Math.ceil(this.totalRecords/e)}catch(l){l.response&&401===l.response.status?(localStorage.setItem("authkey",""),this.$message({message:"授权认证失败，请重试！",type:"warning",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3)):(this.$message({message:l,type:"error",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3))}},handleSizeChange(e){this.currentPage=1,this.pageSize=e,this.fetchProjectListByPage()},handleCurrentChange(e){this.currentPage=e,this.fetchProjectListByPage()},showAddProjectForm(){this.addFormVisible=!0},cancelAdd(){this.addFormVisible=!1},async searchProjects(){this.currentPage=1,this.fetchProjectListByPage()},getDocsUrl(e){return this.$store.state.baseUrl+"/help?project_id="+e}},created(){this.fetchProjectListByPage(this.currentPage)}};const I=(0,h.Z)(U,[["render",A],["__scopeId","data-v-5f677f29"]]);var D=I;const C=e=>((0,o.dD)("data-v-46a2eeec"),e=e(),(0,o.Cn)(),e),v=C((()=>(0,o._)("h2",null,"数据源管理",-1))),$=C((()=>(0,o._)("br",null,null,-1))),K=C((()=>(0,o._)("br",null,null,-1))),B=C((()=>(0,o._)("br",null,null,-1))),S=C((()=>(0,o._)("br",null,null,-1))),L={class:"action-buttons"},z={class:"pagination-container"};function F(e,t,a,i,d,r){const u=(0,o.up)("el-input"),n=(0,o.up)("el-col"),m=(0,o.up)("el-button"),c=(0,o.up)("el-row"),p=(0,o.up)("el-form-item"),h=(0,o.up)("el-form"),w=(0,o.up)("el-dialog"),g=(0,o.up)("el-divider"),f=(0,o.up)("el-table-column"),y=(0,o.up)("el-tooltip"),_=(0,o.up)("el-table"),b=(0,o.up)("el-pagination");return(0,o.wg)(),(0,o.iD)("div",null,[v,(0,o.Wm)(c,{type:"flex",justify:"center",gutter:"10"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{span:4},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.dbname,"onUpdate:modelValue":t[0]||(t[0]=e=>d.searchParams.dbname=e),placeholder:"数据库名"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:4},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.memo,"onUpdate:modelValue":t[1]||(t[1]=e=>d.searchParams.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{type:"primary",onClick:r.searchDBs},{default:(0,o.w5)((()=>[(0,o.Uk)("搜索")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(n,{span:1},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{type:"success",onClick:r.showAddDBForm},{default:(0,o.w5)((()=>[(0,o.Uk)("添加数据库")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.Wm)(w,{title:"添加数据库",modelValue:d.addFormVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>d.addFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{onSubmit:(0,l.iM)(r.addDB,["prevent"]),class:"add-db-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{label:"数据库名"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newDB.dbname,"onUpdate:modelValue":t[2]||(t[2]=e=>d.newDB.dbname=e),placeholder:"数据库名",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"IP"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newDB.ip,"onUpdate:modelValue":t[3]||(t[3]=e=>d.newDB.ip=e),placeholder:"IP",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"端口"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newDB.port,"onUpdate:modelValue":t[4]||(t[4]=e=>d.newDB.port=e),placeholder:"端口",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"用户名"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newDB.user,"onUpdate:modelValue":t[5]||(t[5]=e=>d.newDB.user=e),placeholder:"用户名",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"密码"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newDB.pwd,"onUpdate:modelValue":t[6]||(t[6]=e=>d.newDB.pwd=e),placeholder:"密码",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newDB.memo,"onUpdate:modelValue":t[7]||(t[7]=e=>d.newDB.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(m,{type:"primary",onClick:r.addDB},{default:(0,o.w5)((()=>[(0,o.Uk)("添加")])),_:1},8,["onClick"]),(0,o.Wm)(m,{onClick:r.cancelAdd},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"]),(0,o.Wm)(g),(0,o.Wm)(_,{data:r.dbs},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{type:"index",label:"ID"}),(0,o.Wm)(f,{prop:"dbname",label:"数据库名"}),(0,o.Wm)(f,{prop:"ip",label:"IP"}),(0,o.Wm)(f,{prop:"port",label:"端口"}),(0,o.Wm)(f,{prop:"user",label:"用户名"}),(0,o.Wm)(f,{prop:"pwd",label:"密码"}),(0,o.Wm)(f,{prop:"memo",label:"备注"}),(0,o.Wm)(f,{label:"信息"},{default:(0,o.w5)((({row:e})=>[(0,o.Wm)(y,{placement:"top"},{content:(0,o.w5)((()=>[(0,o.Uk)(" 最后更新人："+(0,s.zw)(e.modified_user)+" ",1),$,(0,o.Uk)(" 更新时间："+(0,s.zw)(e.modified_stime)+" ",1),K,(0,o.Uk)(" 创建人："+(0,s.zw)(e.created_user)+" ",1),B,(0,o.Uk)(" 创建时间："+(0,s.zw)(e.created_stime)+" ",1),S])),default:(0,o.w5)((()=>[(0,o.Wm)(m,{type:"info",size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("信息")])),_:1})])),_:2},1024)])),_:1}),(0,o.Wm)(f,{label:"操作"},{default:(0,o.w5)((e=>[(0,o._)("div",L,[(0,o.Wm)(m,{type:"warning",onClick:t=>r.showUpdateForm(e.row.id),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("更新")])),_:2},1032,["onClick"]),(0,o.Wm)(m,{type:"danger",onClick:t=>r.confirmDelete(e.row.id),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("删除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"]),(0,o.Wm)(g),(0,o._)("div",z,[(0,o.Wm)(b,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,"current-page":d.currentPage,"page-sizes":[10,20,50,100],"page-size":d.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:d.totalRecords},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),(0,o.Wm)(w,{title:"更新数据库信息",modelValue:d.updateFormVisible,"onUpdate:modelValue":t[16]||(t[16]=e=>d.updateFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{onSubmit:(0,l.iM)(r.updateDBInfo,["prevent"]),class:"update-db-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{label:"用户名"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedDB.user,"onUpdate:modelValue":t[9]||(t[9]=e=>d.updatedDB.user=e),placeholder:"用户名",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"密码"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedDB.pwd,"onUpdate:modelValue":t[10]||(t[10]=e=>d.updatedDB.pwd=e),placeholder:"密码",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedDB.memo,"onUpdate:modelValue":t[11]||(t[11]=e=>d.updatedDB.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"数据库名"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedDB.dbname,"onUpdate:modelValue":t[12]||(t[12]=e=>d.updatedDB.dbname=e),placeholder:"数据库名",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"IP"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedDB.ip,"onUpdate:modelValue":t[13]||(t[13]=e=>d.updatedDB.ip=e),placeholder:"IP",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{label:"端口"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedDB.port,"onUpdate:modelValue":t[14]||(t[14]=e=>d.updatedDB.port=e),placeholder:"端口",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(u,{type:"hidden",modelValue:d.updatedDB.id,"onUpdate:modelValue":t[15]||(t[15]=e=>d.updatedDB.id=e)},null,8,["modelValue"]),(0,o.Wm)(m,{type:"primary",onClick:r.updateDBInfo},{default:(0,o.w5)((()=>[(0,o.Uk)("保存")])),_:1},8,["onClick"]),(0,o.Wm)(m,{onClick:r.cancelUpdate},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"])])}var q={name:"DBList",data(){return{searchParams:{memo:"",dbname:""},newDB:{user:"",pwd:"",memo:"",dbname:"",ip:"",port:""},updateFormVisible:!1,updatedDB:{id:"",user:"",pwd:"",memo:"",dbname:"",ip:"",port:""},currentPage:1,totalPages:0,pageSize:10,totalRecords:0,addFormVisible:!1}},computed:{dbs(){return this.$store.state.db.dbs}},methods:{async addDB(){const e=await this.$store.dispatch("db/addDb",this.newDB);200===e.code?(console.log(e),this.$message({type:"success",message:"添加成功"})):this.$message({type:"error",message:"添加失败"}),this.newDB={user:"",pwd:"",memo:"",dbname:"",ip:"",port:""},this.fetchDBListByPage(),this.addFormVisible=!1},async removeDB(e){const t=await this.$store.dispatch("db/removeDb",e);200===t.code?(console.log(t),this.$message({type:"success",message:"删除成功"})):this.$message({type:"error",message:"删除失败"}),this.fetchDBListByPage()},confirmDelete(e){this.$confirm("确定要删除此数据库吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeDB(e)})).catch((()=>{}))},showUpdateForm(e){const t=this.dbs.find((t=>t.id===e));this.updatedDB={id:t.id,user:t.user,pwd:t.pwd,memo:t.memo,dbname:t.dbname,ip:t.ip,port:t.port},this.updateFormVisible=!0},async updateDBInfo(){const e=await this.$store.dispatch("db/updateDb",this.updatedDB);200===e.code?(console.log(e),this.$message({type:"success",message:"更新成功"})):this.$message({type:"error",message:"更新失败"}),this.updatedDB={id:"",user:"",pwd:"",memo:"",dbname:"",ip:"",port:""},this.updateFormVisible=!1,this.fetchDBListByPage()},cancelUpdate(){this.updateFormVisible=!1},async fetchDBListByPage(){const e=this.pageSize,t=(this.currentPage-1)*e;let a="";this.searchParams.dbname&&(a+=` AND dbname LIKE '%${this.searchParams.dbname}%'`),this.searchParams.memo&&(a+=` AND memo LIKE '%${this.searchParams.memo}%'`),a+=` limit ${t},${e}`;try{const t=await this.$store.dispatch("db/fetchDBsPaged",{limit:a});this.totalRecords=t.data.length?parseInt(t.data[0].allcnt):0,this.totalPages=Math.ceil(this.totalRecords/e)}catch(l){l.response&&401===l.response.status?(localStorage.setItem("authkey",""),this.$message({message:"授权认证失败，请重试！",type:"warning",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3)):(this.$message({message:l,type:"error",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3))}},handleSizeChange(e){this.currentPage=1,this.pageSize=e,this.fetchDBListByPage()},handleCurrentChange(e){this.currentPage=e,this.fetchDBListByPage()},showAddDBForm(){this.addFormVisible=!0},cancelAdd(){this.addFormVisible=!1},async searchDBs(){this.currentPage=1,this.fetchDBListByPage()}},created(){this.fetchDBListByPage()}};const x=(0,h.Z)(q,[["render",F],["__scopeId","data-v-46a2eeec"]]);var H=x;const T=e=>((0,o.dD)("data-v-706840bc"),e=e(),(0,o.Cn)(),e),Z=T((()=>(0,o._)("h2",null,"密钥管理",-1))),R=T((()=>(0,o._)("br",null,null,-1))),M=T((()=>(0,o._)("br",null,null,-1))),N=T((()=>(0,o._)("br",null,null,-1))),O=T((()=>(0,o._)("br",null,null,-1))),E={class:"action-buttons"},Y={class:"pagination-container"};function Q(e,t,a,i,d,r){const u=(0,o.up)("el-input"),n=(0,o.up)("el-col"),m=(0,o.up)("el-option"),c=(0,o.up)("el-select"),p=(0,o.up)("el-button"),h=(0,o.up)("el-row"),w=(0,o.up)("el-form-item"),g=(0,o.up)("el-form"),f=(0,o.up)("el-dialog"),y=(0,o.up)("el-divider"),_=(0,o.up)("el-table-column"),b=(0,o.up)("el-tooltip"),P=(0,o.up)("el-table"),W=(0,o.up)("el-pagination");return(0,o.wg)(),(0,o.iD)("div",null,[Z,(0,o.Wm)(h,{type:"flex",justify:"center",gutter:"10"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{span:3},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.authkey,"onUpdate:modelValue":t[0]||(t[0]=e=>d.searchParams.authkey=e),placeholder:"AuthKey"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:3},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.searchParams.project_id,"onUpdate:modelValue":t[1]||(t[1]=e=>d.searchParams.project_id=e),placeholder:"项目",filterable:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.projectList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.project_id,label:e.project_name,value:e.project_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:4},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.memo,"onUpdate:modelValue":t[2]||(t[2]=e=>d.searchParams.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"primary",onClick:r.searchAuthKeys},{default:(0,o.w5)((()=>[(0,o.Uk)("搜索")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(n,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"success",onClick:t[3]||(t[3]=e=>r.showAddAuthkeyForm())},{default:(0,o.w5)((()=>[(0,o.Uk)("添加AuthKey")])),_:1})])),_:1})])),_:1}),(0,o.Wm)(f,{title:"添加 AuthKey",modelValue:d.addFormVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>d.addFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{onSubmit:(0,l.iM)(r.addAuthKey,["prevent"]),class:"add-authkey-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{label:"项目"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.newAuthKey.project_id,"onUpdate:modelValue":t[4]||(t[4]=e=>d.newAuthKey.project_id=e),placeholder:"项目ID",required:"",filterable:"",onChange:r.fetchAPIList},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.projectList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.project_id,label:e.project_name,value:e.project_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,o.Wm)(w,{label:"API IDs"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.newAuthKey.api_ids,"onUpdate:modelValue":t[5]||(t[5]=e=>d.newAuthKey.api_ids=e),placeholder:"API IDs",multiple:"",filterable:""},{default:(0,o.w5)((()=>[d.newAuthKey.project_id?((0,o.wg)(),(0,o.j4)(m,{key:0,label:"全部",value:"-1"})):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.apiList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.api_id,label:e.apiname,value:e.api_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newAuthKey.memo,"onUpdate:modelValue":t[6]||(t[6]=e=>d.newAuthKey.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{type:"primary",onClick:r.addAuthKey},{default:(0,o.w5)((()=>[(0,o.Uk)("添加")])),_:1},8,["onClick"]),(0,o.Wm)(p,{onClick:r.cancelAdd},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"]),(0,o.Wm)(y),(0,o.Wm)(P,{data:r.authKeys},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{type:"index",label:"ID"}),(0,o.Wm)(_,{prop:"authkey",label:"AuthKey"}),(0,o.Wm)(_,{prop:"project_name",label:"项目"}),(0,o.Wm)(_,{prop:"api_ids",label:"API IDs"}),(0,o.Wm)(_,{prop:"memo",label:"备注"}),(0,o.Wm)(_,{label:"信息"},{default:(0,o.w5)((({row:e})=>[(0,o.Wm)(b,{placement:"top"},{content:(0,o.w5)((()=>[(0,o.Uk)(" 最后更新人："+(0,s.zw)(e.modified_user)+" ",1),R,(0,o.Uk)(" 更新时间："+(0,s.zw)(e.modified_stime)+" ",1),M,(0,o.Uk)(" 创建人："+(0,s.zw)(e.created_user)+" ",1),N,(0,o.Uk)(" 创建时间："+(0,s.zw)(e.created_stime)+" ",1),O])),default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"info",size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("信息")])),_:1})])),_:2},1024)])),_:1}),(0,o.Wm)(_,{label:"操作"},{default:(0,o.w5)((e=>[(0,o._)("div",E,[(0,o.Wm)(p,{type:"warning",onClick:t=>r.showUpdateForm(e.row.authkey),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("更新")])),_:2},1032,["onClick"]),(0,o.Wm)(p,{type:"danger",onClick:t=>r.confirmDelete(e.row.authkey),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("删除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"]),(0,o.Wm)(y),(0,o._)("div",Y,[(0,o.Wm)(W,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,"current-page":d.currentPage,"page-sizes":[10,20,50,100],"page-size":d.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:d.totalRecords},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),(0,o.Wm)(f,{title:"更新AuthKey 信息",modelValue:d.updateFormVisible,"onUpdate:modelValue":t[12]||(t[12]=e=>d.updateFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{onSubmit:(0,l.iM)(r.updateAuthKeyInfo,["prevent"]),class:"update-authkey-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{label:"AuthKey"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedAuthKey.authkey,"onUpdate:modelValue":t[8]||(t[8]=e=>d.updatedAuthKey.authkey=e),placeholder:"AuthKey",readonly:"",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"API IDs"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.updatedAuthKey.api_ids,"onUpdate:modelValue":t[9]||(t[9]=e=>d.updatedAuthKey.api_ids=e),placeholder:"API IDs",multiple:"",filterable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{label:"全部",value:"-1"}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.apiList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.api_id,label:e.apiname,value:e.api_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedAuthKey.memo,"onUpdate:modelValue":t[10]||(t[10]=e=>d.updatedAuthKey.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(u,{type:"hidden",modelValue:d.updatedAuthKey.id,"onUpdate:modelValue":t[11]||(t[11]=e=>d.updatedAuthKey.id=e)},null,8,["modelValue"]),(0,o.Wm)(p,{type:"primary",onClick:r.updateAuthKeyInfo},{default:(0,o.w5)((()=>[(0,o.Uk)("保存")])),_:1},8,["onClick"]),(0,o.Wm)(p,{onClick:r.cancelUpdate},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"])])}var G={name:"AuthKeyList",data(){return{apiList:[],projectList:[],searchParams:{project_id:"",authkey:"",memo:""},newAuthKey:{project_id:"",api_ids:"",memo:""},updateFormVisible:!1,updatedAuthKey:{id:"",authkey:"",project_id:"",api_ids:"",memo:""},currentPage:1,totalPages:0,pageSize:10,totalRecords:0,addFormVisible:!1}},computed:{authKeys(){return this.$store.state.authkey.authKeys}},methods:{async addAuthKey(){this.newAuthKey.api_ids=this.newAuthKey.api_ids.join(",");const e=await this.$store.dispatch("authkey/addAuthKey",this.newAuthKey);200===e.code?(console.log(e),this.$message({type:"success",message:"添加成功"})):this.$message({type:"error",message:"添加失败"}),this.newAuthKey={project_id:"",api_ids:"",memo:""},this.fetchAuthKeyListByPage(),this.addFormVisible=!1},async removeAuthKey(e){const t=await this.$store.dispatch("authkey/removeAuthKey",e);200===t.code?(console.log(t),this.$message({type:"success",message:"删除成功"})):this.$message({type:"error",message:"删除失败"}),this.fetchAuthKeyListByPage(),this.addFormVisible=!1},confirmDelete(e){this.$confirm("确定要删除此 AuthKey 吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeAuthKey(e)})).catch((()=>{}))},showUpdateForm(e){const t=this.authKeys.find((t=>t.authkey===e));this.fetchAPIList(t.project_id);const a=t.api_ids.split(",").map(String);this.updatedAuthKey={id:t.id,authkey:t.authkey,api_ids:a,memo:t.memo},this.updateFormVisible=!0},async updateAuthKeyInfo(){this.updatedAuthKey.api_ids=this.updatedAuthKey.api_ids.join(",");const e=await this.$store.dispatch("authkey/updateAuthKey",this.updatedAuthKey);console.log(e),200===e.code?this.$message({type:"success",message:"更新成功"}):this.$message({type:"error",message:"更新失败"}),this.updatedAuthKey={id:"",authkey:"",api_ids:"",memo:""},this.updateFormVisible=!1,this.fetchAuthKeyListByPage()},cancelUpdate(){this.updateFormVisible=!1},async fetchAuthKeyListByPage(){const e=this.pageSize,t=(this.currentPage-1)*e;let a="";this.searchParams.project_id&&(a+=` AND project_id= '${this.searchParams.project_id}' `),this.searchParams.authkey&&(a+=` AND authkey = '${this.searchParams.authkey}'`),this.searchParams.memo&&(a+=` AND memo LIKE '%${this.searchParams.memo}%'`),a+=` limit ${t},${e}`;try{const t=await this.$store.dispatch("authkey/fetchAuthKeysPaged",{limit:a});this.totalRecords=t.data.length?parseInt(t.data[0].allcnt):0,this.totalPages=Math.ceil(this.totalRecords/e),this.fetchProjectList()}catch(l){l.response&&401===l.response.status?(localStorage.setItem("authkey",""),this.$message({message:"授权认证失败，请重试！",type:"warning",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3)):(this.$message({message:l,type:"error",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3))}},handleSizeChange(e){this.currentPage=1,this.pageSize=e,this.fetchAuthKeyListByPage()},handleCurrentChange(e){this.currentPage=e,this.fetchAuthKeyListByPage()},async fetchProjectList(){const e="",t=await this.$store.dispatch("project/fetchProjectsPaged",{limit:e});this.projectList=t.data},async fetchAPIList(e){const t=e||this.newAuthKey.project_id,a=t?` AND project_id='${t}'`:"",l=await this.$store.dispatch("api/fetchAPIsPaged",{limit:a});this.apiList=l.data},showAddAuthkeyForm(){this.addFormVisible=!0},cancelAdd(){this.addFormVisible=!1},async searchAuthKeys(){this.currentPage=1,this.fetchAuthKeyListByPage()}},created(){this.fetchAuthKeyListByPage(this.currentPage)}};const J=(0,h.Z)(G,[["render",Q],["__scopeId","data-v-706840bc"]]);var X=J;const ee=e=>((0,o.dD)("data-v-9e53ff82"),e=e(),(0,o.Cn)(),e),te=ee((()=>(0,o._)("h2",null,"API 管理",-1))),ae=ee((()=>(0,o._)("br",null,null,-1))),le=ee((()=>(0,o._)("br",null,null,-1))),oe=ee((()=>(0,o._)("br",null,null,-1))),se=ee((()=>(0,o._)("br",null,null,-1))),ie={class:"action-buttons"},de={class:"pagination-container"};function re(e,t,a,i,d,r){const u=(0,o.up)("el-input"),n=(0,o.up)("el-col"),m=(0,o.up)("el-option"),c=(0,o.up)("el-select"),p=(0,o.up)("el-button"),h=(0,o.up)("el-row"),w=(0,o.up)("el-form-item"),g=(0,o.up)("el-form"),f=(0,o.up)("el-dialog"),y=(0,o.up)("el-divider"),_=(0,o.up)("el-table-column"),b=(0,o.up)("el-popover"),P=(0,o.up)("el-tooltip"),W=(0,o.up)("el-table"),V=(0,o.up)("el-pagination");return(0,o.wg)(),(0,o.iD)("div",null,[te,(0,o.Wm)(h,{type:"flex",justify:"center",gutter:"10"},{default:(0,o.w5)((()=>[(0,o.Wm)(n,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.api_id,"onUpdate:modelValue":t[0]||(t[0]=e=>d.searchParams.api_id=e),placeholder:"ApiId"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:3},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.apiname,"onUpdate:modelValue":t[1]||(t[1]=e=>d.searchParams.apiname=e),placeholder:"API名称"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:3},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.searchParams.project_id,"onUpdate:modelValue":t[2]||(t[2]=e=>d.searchParams.project_id=e),placeholder:"项目",filterable:"",clearable:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.projectList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.project_id,label:e.project_name,value:e.project_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:4},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.searchParams.memo,"onUpdate:modelValue":t[3]||(t[3]=e=>d.searchParams.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(n,{span:2},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"primary",onClick:r.searchAPIs},{default:(0,o.w5)((()=>[(0,o.Uk)("搜索")])),_:1},8,["onClick"])])),_:1}),(0,o.Wm)(n,{span:1},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"success",onClick:t[4]||(t[4]=e=>r.showAddAPIForm())},{default:(0,o.w5)((()=>[(0,o.Uk)("添加API")])),_:1})])),_:1})])),_:1}),(0,o.Wm)(f,{title:"添加API",modelValue:d.addFormVisible,"onUpdate:modelValue":t[11]||(t[11]=e=>d.addFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{onSubmit:(0,l.iM)(r.addAPI,["prevent"]),class:"add-api-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{label:"API名称"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newAPI.apiname,"onUpdate:modelValue":t[5]||(t[5]=e=>d.newAPI.apiname=e),placeholder:"API名称",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"项目"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.newAPI.project_id,"onUpdate:modelValue":t[6]||(t[6]=e=>d.newAPI.project_id=e),placeholder:"项目",required:"",filterable:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.projectList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.project_id,label:e.project_name,value:e.project_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"数据库ID"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.newAPI.db_id,"onUpdate:modelValue":t[7]||(t[7]=e=>d.newAPI.db_id=e),placeholder:"数据库",required:"",filterable:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.dbList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.db_id,label:e.dbname,value:e.db_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"联接条件"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newAPI.joint,"onUpdate:modelValue":t[8]||(t[8]=e=>d.newAPI.joint=e),placeholder:"联接条件"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"源SQL"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newAPI.sourcesql,"onUpdate:modelValue":t[9]||(t[9]=e=>d.newAPI.sourcesql=e),placeholder:"源SQL(请勿使用单引号)",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.newAPI.memo,"onUpdate:modelValue":t[10]||(t[10]=e=>d.newAPI.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(p,{type:"primary",onClick:r.addAPI},{default:(0,o.w5)((()=>[(0,o.Uk)("添加")])),_:1},8,["onClick"]),(0,o.Wm)(p,{onClick:r.cancelAdd},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"]),(0,o.Wm)(y),(0,o.Wm)(W,{data:r.apis},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{type:"index",label:"ID"}),(0,o.Wm)(_,{prop:"api_id",label:"ApiId"}),(0,o.Wm)(_,{prop:"apiname",label:"API名称"}),(0,o.Wm)(_,{prop:"project_name",label:"项目"}),(0,o.Wm)(_,{prop:"dbname",label:"数据源"}),(0,o.Wm)(_,{prop:"joint",label:"联合鉴权"}),(0,o.Wm)(_,{label:"源SQL"},{default:(0,o.w5)((e=>[(0,o.Wm)(b,{width:400,placement:"top",trigger:"click",content:e.row.sourcesql},{reference:(0,o.w5)((()=>[(0,o.Wm)(p,{size:"default"},{default:(0,o.w5)((()=>[(0,o.Uk)("查看源SQL")])),_:1})])),_:2},1032,["content"])])),_:1}),(0,o.Wm)(_,{prop:"memo",label:"备注"}),(0,o.Wm)(_,{label:"信息"},{default:(0,o.w5)((({row:e})=>[(0,o.Wm)(P,{placement:"top"},{content:(0,o.w5)((()=>[(0,o.Uk)(" 最后更新人："+(0,s.zw)(e.modified_user)+" ",1),ae,(0,o.Uk)(" 更新时间："+(0,s.zw)(e.modified_stime)+" ",1),le,(0,o.Uk)(" 创建人："+(0,s.zw)(e.created_user)+" ",1),oe,(0,o.Uk)(" 创建时间："+(0,s.zw)(e.created_stime)+" ",1),se])),default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"info",size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("信息")])),_:1})])),_:2},1024)])),_:1}),(0,o.Wm)(_,{label:"操作"},{default:(0,o.w5)((e=>[(0,o._)("div",ie,[(0,o.Wm)(p,{type:"warning",onClick:t=>r.showUpdateForm(e.row.id),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("更新")])),_:2},1032,["onClick"]),(0,o.Wm)(p,{type:"danger",onClick:t=>r.confirmDelete(e.row.id),size:"small"},{default:(0,o.w5)((()=>[(0,o.Uk)("删除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"]),(0,o.Wm)(y),(0,o._)("div",de,[(0,o.Wm)(V,{onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,"current-page":d.currentPage,"page-sizes":[10,20,50,100],"page-size":d.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:d.totalRecords},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),(0,o.Wm)(f,{title:"更新 API 信息",modelValue:d.updateFormVisible,"onUpdate:modelValue":t[18]||(t[18]=e=>d.updateFormVisible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{onSubmit:(0,l.iM)(r.updateAPIInfo,["prevent"]),class:"update-api-form"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{label:"API名称"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedAPI.apiname,"onUpdate:modelValue":t[12]||(t[12]=e=>d.updatedAPI.apiname=e),placeholder:"API名称",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"数据库ID"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{modelValue:d.updatedAPI.db_id,"onUpdate:modelValue":t[13]||(t[13]=e=>d.updatedAPI.db_id=e),placeholder:"数据库",required:"",filterable:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.dbList,(e=>((0,o.wg)(),(0,o.j4)(m,{key:e.db_id,label:e.dbname,value:e.db_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"联接条件"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedAPI.joint,"onUpdate:modelValue":t[14]||(t[14]=e=>d.updatedAPI.joint=e),placeholder:"联接条件"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"源SQL"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedAPI.sourcesql,"onUpdate:modelValue":t[15]||(t[15]=e=>d.updatedAPI.sourcesql=e),placeholder:"源SQL",type:"textarea",required:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(w,{label:"备注"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{modelValue:d.updatedAPI.memo,"onUpdate:modelValue":t[16]||(t[16]=e=>d.updatedAPI.memo=e),placeholder:"备注"},null,8,["modelValue"])])),_:1}),(0,o.Wm)(u,{type:"hidden",modelValue:d.updatedAPI.id,"onUpdate:modelValue":t[17]||(t[17]=e=>d.updatedAPI.id=e)},null,8,["modelValue"]),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{type:"primary",onClick:r.updateAPIInfo},{default:(0,o.w5)((()=>[(0,o.Uk)("保存")])),_:1},8,["onClick"]),(0,o.Wm)(p,{onClick:r.cancelUpdate},{default:(0,o.w5)((()=>[(0,o.Uk)("取消")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["modelValue"])])}var ue={name:"APIList",data(){return{dbList:[],projectList:[],searchParams:{api_id:"",apiname:"",project_id:"",memo:""},newAPI:{apiname:"",project_id:"",db_id:"",joint:"",sourcesql:"",memo:""},updateFormVisible:!1,updatedAPI:{id:"",apiname:"",project_id:"",db_id:"",joint:"",sourcesql:"",memo:""},currentPage:1,totalPages:0,pageSize:10,totalRecords:0,addFormVisible:!1}},computed:{apis(){return this.$store.state.api.apis}},methods:{async addAPI(){if(""===this.newAPI.apiname.trim())return void this.$message({type:"error",message:"API名称不能为空"});const e=await this.$store.dispatch("api/addAPI",this.newAPI);200===e.code?(console.log(e),this.$message({type:"success",message:"添加成功"})):this.$message({type:"error",message:"添加失败"}),this.newAPI={apiname:"",project_id:"",db_id:"",joint:"",sourcesql:"",memo:""},this.fetchAPIListByPage(),this.addFormVisible=!1},async removeAPI(e){const t=await this.$store.dispatch("api/removeAPI",e);200===t.code?(console.log(t),this.$message({type:"success",message:"删除成功"})):this.$message({type:"error",message:"删除失败"}),this.fetchAPIListByPage()},confirmDelete(e){this.$confirm("确定要删除此 API 吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeAPI(e)})).catch((()=>{}))},showUpdateForm(e){const t=this.apis.find((t=>t.id===e));this.updatedAPI={id:t.id,apiname:t.apiname,project_id:t.project_id,db_id:t.db_id,joint:t.joint,sourcesql:t.sourcesql,memo:t.memo},this.updateFormVisible=!0},async updateAPIInfo(){if(""===this.updatedAPI.apiname.trim())return void this.$message({type:"error",message:"API名称不能为空"});const e=await this.$store.dispatch("api/updateAPI",this.updatedAPI);200===e.code?(console.log(e),this.$message({type:"success",message:"更新成功"})):this.$message({type:"error",message:"更新失败"}),this.updatedAPI={id:"",apiname:"",project_id:"",db_id:"",joint:"",sourcesql:"",memo:""},this.updateFormVisible=!1,this.fetchAPIListByPage()},cancelUpdate(){this.updateFormVisible=!1},async fetchAPIListByPage(){const e=this.pageSize,t=(this.currentPage-1)*e;let a="";this.searchParams.api_id&&(a+=` AND api_id='${this.searchParams.api_id}'`),this.searchParams.project_id&&(a+=` AND project_id='${this.searchParams.project_id}'`),this.searchParams.apiname&&(a+=` AND apiname LIKE '%${this.searchParams.apiname}%'`),this.searchParams.memo&&(a+=` AND memo LIKE '%${this.searchParams.memo}%'`),a+=` limit ${t},${e}`;try{const t=await this.$store.dispatch("api/fetchAPIsPaged",{limit:a});this.totalRecords=t.data.length?parseInt(t.data[0].allcnt):0,this.totalPages=Math.ceil(this.totalRecords/e),this.fetchProjectList(),this.fetchDBList()}catch(l){l.response&&401===l.response.status?(localStorage.setItem("authkey",""),this.$message({message:"授权认证失败，请重试！",type:"warning",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3)):(this.$message({message:l,type:"error",showClose:!0,duration:0}),setTimeout((()=>{window.location.reload()}),3e3))}},handleSizeChange(e){this.currentPage=1,this.pageSize=e,this.fetchAPIListByPage()},handleCurrentChange(e){this.currentPage=e,this.fetchAPIListByPage()},async fetchProjectList(){const e="",t=await this.$store.dispatch("project/fetchProjectsPaged",{limit:e});this.projectList=t.data},async fetchDBList(){const e="",t=await this.$store.dispatch("db/fetchDBsPaged",{limit:e});this.dbList=t.data},showAddAPIForm(){this.addFormVisible=!0},cancelAdd(){this.addFormVisible=!1},async searchAPIs(){this.currentPage=1,this.fetchAPIListByPage()}},created(){this.fetchAPIListByPage(this.currentPage)}};const ne=(0,h.Z)(ue,[["render",re],["__scopeId","data-v-9e53ff82"]]);var me=ne;const ce=[{path:"/",redirect:"/project-list"},{path:"/project-list",name:"ProjectList",component:D},{path:"/db-list",name:"DBList",component:H},{path:"/authkey-list",name:"AuthKeyList",component:X},{path:"/api-list",name:"APIList",component:me}],pe=(0,f.p7)({history:(0,f.PO)("/"),routes:ce});var he=pe,we=a(65),ge=a(4161);const fe={apis:[]},ye={setApis(e,t){e.apis=t}},_e={async fetchAPIsPaged({commit:e,dispatch:t,rootState:a},{limit:l}){const o=await t("getHeaders",null,{root:!0}),{data:s}=await ge.Z.post(`${a.baseUrl}/api?api_id=8181e1ca`,{limit:l},{headers:o});return e("setApis",s.data),s},async addAPI({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=7b2e8161`,o,{headers:s});return 0===i.code&&e("setApis",[...t.apis,i.data]),i},async removeAPI({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=ab2e81aa`,{api_id:o},{headers:s});return 0===i.code&&e("setApis",t.apis.filter((e=>e.id!==o))),i},async updateAPI({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=1616e7b2`,o,{headers:s});return 0===i.code&&e("setApis",[...t.apis,i.data]),i}};var be={namespaced:!0,state:fe,mutations:ye,actions:_e};const Pe={projects:[]},We={setProjects(e,t){e.projects=t}},Ve={async fetchProjectsPaged({commit:e,dispatch:t,rootState:a},{limit:l}){const o=await t("getHeaders",null,{root:!0}),{data:s}=await ge.Z.post(`${a.baseUrl}/api?api_id=c616e72a`,{limit:l},{headers:o});return e("setProjects",s.data),s},async addProject({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=611c6164`,o,{headers:s});return 0===i.code&&e("setProjects",[...t.projects,i.data]),i},async removeProject({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=e8181ee7`,{project_id:o},{headers:s});return 0===i.code&&e("setProjects",t.projects.filter((e=>e.id!==o))),i},async updateProject({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=e7b2e812`,o,{headers:s});return 0===i.code&&e("setProjects",t.projects.map((e=>e.id===o.id?i.data:e))),i}};var je={namespaced:!0,state:Pe,mutations:We,actions:Ve};const ke={dbs:[]},Ae={setDBs(e,t){e.dbs=t}},Ue={async fetchDBsPaged({commit:e,dispatch:t,rootState:a},{limit:l}){const o=await t("getHeaders",null,{root:!0}),{data:s}=await ge.Z.post(`${a.baseUrl}/api?api_id=e8e8181r`,{limit:l},{headers:o});return e("setDBs",s.data),s},async addDb({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=e7b2e813`,o,{headers:s});return 0===i.code&&e("setDBs",[...t.dbs,i.data]),i},async removeDb({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=b2e81aca`,{db_id:o},{headers:s});return 0===i.code&&e("setDBs",t.dbs.filter((e=>e.id!==o))),i},async updateDb({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=1e1c616e`,o,{headers:s});return 0===i.code&&e("setDBs",[...t.dbs,i.data]),i}};var Ie={namespaced:!0,state:ke,mutations:Ae,actions:Ue};const De={authKeys:[]},Ce={setAuthKeys(e,t){e.authKeys=t}},ve={async fetchAuthKeysPaged({commit:e,dispatch:t,rootState:a},{limit:l}){const o=await t("getHeaders",null,{root:!0}),{data:s}=await ge.Z.post(`${a.baseUrl}/api?api_id=e8181ee2`,{limit:l},{headers:o});return e("setAuthKeys",s.data),s},async addAuthKey({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=81e616e3`,o,{headers:s});return 0===i.code&&e("setAuthKeys",[...t.authKeys,i.data]),i},async removeAuthKey({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=81acavb2`,{auth_key:o},{headers:s});return 0===i.code&&e("setAuthKeys",t.authKeys.filter((e=>e.id!==o))),i},async updateAuthKey({commit:e,state:t,rootState:a,dispatch:l},o){const s=await l("getHeaders",null,{root:!0}),{data:i}=await ge.Z.post(`${a.baseUrl}/api?api_id=716e71c6`,o,{headers:s});return 0===i.code&&e("setAuthKeys",[...t.authKeys,i.data]),i}};var $e={namespaced:!0,state:De,mutations:Ce,actions:ve},Ke=(0,we.MT)({state:{baseUrl:"",authKey:localStorage.getItem("authkey"),Token:localStorage.getItem("token")},mutations:{},actions:{getHeaders({state:e}){return{"Content-Type":"application/json",authkey:e.authKey,token:e.huhangToken}}},modules:{api:be,project:je,authkey:$e,db:Ie}}),Be=a(9529);a(2834);const Se=(0,l.ri)(g);Se.use(he),Se.use(Ke),Se.use(Be.Z),Se.mount("#app")}},t={};function a(l){var o=t[l];if(void 0!==o)return o.exports;var s=t[l]={exports:{}};return e[l].call(s.exports,s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,l,o,s){if(!l){var i=1/0;for(n=0;n<e.length;n++){l=e[n][0],o=e[n][1],s=e[n][2];for(var d=!0,r=0;r<l.length;r++)(!1&s||i>=s)&&Object.keys(a.O).every((function(e){return a.O[e](l[r])}))?l.splice(r--,1):(d=!1,s<i&&(i=s));if(d){e.splice(n--,1);var u=o();void 0!==u&&(t=u)}}return t}s=s||0;for(var n=e.length;n>0&&e[n-1][2]>s;n--)e[n]=e[n-1];e[n]=[l,o,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,l){var o,s,i=l[0],d=l[1],r=l[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(o in d)a.o(d,o)&&(a.m[o]=d[o]);if(r)var n=r(a)}for(t&&t(l);u<i.length;u++)s=i[u],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(n)},l=self["webpackChunksqlrest_manage_ui"]=self["webpackChunksqlrest_manage_ui"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[998],(function(){return a(9379)}));l=a.O(l)})();
//# sourceMappingURL=app.123f8ceb.js.map